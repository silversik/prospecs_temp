<html>

<head>
    <meta charset="UTF-8">
    <title>프로스펙스</title>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
    <style>
        @font-face {
            font-family: 'General Sans';
            src: url('./font/GeneralSans/GeneralSans-Semibold.woff2') format('woff2'),
                url('./font/GeneralSans/GeneralSans-Semibold.woff') format('woff'),
                url('./font/GeneralSans/GeneralSans-Semibold.ttf') format('truetype');
            font-weight: 600;
            font-display: swap;
            font-style: normal;
        }
    </style>
    <link rel="stylesheet" href="./css/pc.css">
    <link rel="stylesheet" href="./lib/img-comparison/img-comparison-slider.css" />
    <div class="popup-wrap">
        <div class="popup-dim"></div>
        <div class="popup right-popup" id="cart-popup">
            <div class="popup-head">
                <p class="popup-title">장바구니</p>
                <button class="close-btn"></button>
            </div>
            <div class="popup-body">
                <div class="select-area">
                    <input type="checkbox" id="select-all-chk">
                    <label for="select-all-chk">전체선택</label>
                    <span class="count-area">
                        (<span class="select-cnt">0</span>/<span class="total-select-cnt">0</span>)</span>
                    <button class="cart-remove-btn">선택 삭제</button>
                </div>
                <div class="prd-list-wrap">
                    <ul>
                        <li>
                            <div>
                                <input type="checkbox" id="cart-prd1">
                            </div>
                            <div class="thumb-wrap">
                                <img src="./img/sample/prd_01.webp" alt="">
                            </div>
                            <div class="info-area">
                                <div>
                                    <p class="prd-title">듀플렉스 GF</p>
                                    <p class="raw-price">49,0000원</p>
                                    <p>
                                        <span class="sale-percent">30%</span>
                                        <span class="sale-price">49,000원</span>
                                    </p>
                                </div>
                                <p class="prd-info">
                                    <span class="color">BLACK</span>
                                    <span class="size">230</span>
                                </p>
                            </div>
                            <div class="control-area">
                                <div class="cart-quantity-control">
                                    <button class="decrease-btn" disabled></button>
                                    <span class="count">0</span>
                                    <button class="increase-btn"></button>
                                </div>
                                <button class="remove-item-btn">삭제</button>
                                <button class="buy-item-btn">구매하기</button>
                            </div>
                        </li>
                        <li>
                            <div>
                                <input type="checkbox" id="cart-prd1">
                            </div>
                            <div class="thumb-wrap">
                                <img src="./img/sample/prd_01.webp" alt="">
                            </div>
                            <div class="info-area">
                                <div>
                                    <p class="prd-title">듀플렉스 GF</p>
                                    <p>
                                        <span class="sale-price">159,000원</span>
                                    </p>
                                </div>
                                <p class="prd-info">
                                    <span class="color">BLACK</span>
                                    <span class="size">230</span>
                                </p>
                            </div>
                            <div class="control-area">
                                <div class="cart-quantity-control">
                                    <button class="decrease-btn" disabled></button>
                                    <span class="count">0</span>
                                    <button class="increase-btn"></button>
                                </div>
                                <button class="remove-item-btn">삭제</button>
                                <button class="buy-item-btn" disabled>일시품절</button>
                            </div>
                        </li>
                        <li>
                            <div>
                                <input type="checkbox" id="cart-prd1">
                            </div>
                            <div class="thumb-wrap">
                                <img src="./img/sample/prd_01.webp" alt="">
                            </div>
                            <div class="info-area">
                                <div>
                                    <p class="prd-title">듀플렉스 GF</p>
                                    <p class="raw-price">49,0000원</p>
                                    <p>
                                        <span class="sale-percent">30%</span>
                                        <span class="sale-price">49,000원</span>
                                    </p>
                                </div>
                                <p class="prd-info">
                                    <span class="color">BLACK</span>
                                    <span class="size">230</span>
                                </p>
                            </div>
                            <div class="control-area">
                                <div class="cart-quantity-control">
                                    <button class="decrease-btn" disabled></button>
                                    <span class="count">0</span>
                                    <button class="increase-btn"></button>
                                </div>
                                <button class="remove-item-btn">삭제</button>
                                <button class="buy-item-btn">구매하기</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="popup-foot">
                <div class="cart-rec-area">
                    <div class="title-area">
                        <p class="cart-rec-title">추천상품</p>
                        <div class="btn-wrap">
                            <button class="prev-btn"></button>
                            <button class="next-btn"></button>
                        </div>
                    </div>
                    <div class="cart-rec-swiper swiper">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="thumb-img">
                                    <img src="./img/sample/cart_rec_prd.jpg" alt="">
                                </div>
                                <div>
                                    <p class="prd-title">경량 4패널 러닝캡</p>
                                    <p>
                                        <span class="sale-price">49,000원</span>
                                        <span class="raw-price">69,000원</span>
                                    </p>

                                    <button class="cart-rec-add-btn"></button>
                                    <div class="cart-rec-add-overlay">
                                        <div>
                                            <div class="custom-select">
                                                <button class="select-btn" type="button">
                                                    <span class="select-text">056</span>
                                                    <span class="select-arrow">
                                                        <img src="./img/ico_select.svg" alt="">
                                                    </span>
                                                </button>
                                                <ul class="select-dropdown">
                                                    <li data-value="056" disabled>056 (품절)</li>
                                                    <li data-value="058">058</li>
                                                    <li data-value="105">105</li>
                                                    <li data-value="105">105</li>
                                                    <li data-value="105">105</li>
                                                    <li data-value="105">105</li>
                                                </ul>
                                            </div>
                                            <button class="rec-add-cart-btn">장바구니 추가</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="thumb-img">
                                    <img src="./img/sample/cart_rec_prd.jpg" alt="">
                                </div>
                                <div>
                                    <p class="prd-title">경량 4패널 러닝캡</p>
                                    <p>
                                        <span class="sale-price">49,000원</span>
                                        <span class="raw-price">69,000원</span>
                                    </p>

                                    <button class="cart-rec-add-btn"></button>
                                    <div class="cart-rec-add-overlay">
                                        <div>
                                            <div class="custom-select">
                                                <button class="select-btn" type="button">
                                                    <span class="select-text">056</span>
                                                    <span class="select-arrow">
                                                        <img src="./img/ico_select.svg" alt="">
                                                    </span>
                                                </button>
                                                <ul class="select-dropdown">
                                                    <li data-value="056" disabled>056 (품절)</li>
                                                    <li data-value="058">058</li>
                                                    <li data-value="105">105</li>
                                                    <li data-value="105">105</li>
                                                    <li data-value="105">105</li>
                                                    <li data-value="105">105</li>
                                                </ul>
                                            </div>
                                            <button class="rec-add-cart-btn">장바구니 추가</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="thumb-img">
                                    <img src="./img/sample/cart_rec_prd.jpg" alt="">
                                </div>
                                <div>
                                    <p class="prd-title">경량 4패널 러닝캡</p>
                                    <p class="status-txt">일시품절</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <ul class="cart-result-list">
                    <li>
                        <span>배송비</span>
                        <span>무료</span>
                    </li>
                    <li>
                        <span>상품 금액</span>
                        <span>N/A</span>
                    </li>
                    <li class="tot-price-info">
                        <span>총 주문금액</span>
                        <span>100,000원</span>
                    </li>
                </ul>
                <button class="buy-btn">구매하기</button>
            </div>
        </div>
    </div>
    <script defer src="./lib/img-comparison/img-comparison-slider.js"></script>
    <script src="./lib/gsap/gsap.min.js"></script>
    <script>
        function initCartPopup() {
            new Swiper('#cart-popup .cart-rec-swiper', {
                loop: true,
                slidesPerView: 1.8,
                spaceBetween: 8,
                navigation: {
                    nextEl: ".next-btn",
                    prevEl: ".prev-btn",
                },
            });

            $('#cart-popup .cart-rec-add-btn').click(function () {
                $overlay = $(this).closest('.swiper-slide').find('.cart-rec-add-overlay');
                $overlay.addClass('show');
                gsap.set($overlay, { opacity: 0, 'overflow': 'hidden' });
                gsap.to($overlay, {
                    duration: 0.2,
                    opacity: 1,
                    ease: "power2.out",
                    onComplete: function () {
                        $overlay.css('overflow', 'unset')
                    }
                });

                $overlayDiv = $overlay.children();
                gsap.set($overlayDiv, { y: '100%' });
                gsap.to($overlayDiv, {
                    duration: 0.3,
                    y: '0',
                    ease: "power2.out"
                });
            })

            $('#cart-popup .custom-select').each(function () {
                var $wrapper = $(this);
                var $select = $wrapper.find('.select-input');
                var $btn = $wrapper.find('.select-btn');
                var $text = $wrapper.find('.select-text');
                var $dropdown = $wrapper.find('.select-dropdown');
                var $options = $dropdown.find('li');

                // 초기 선택값 설정
                var initialValue = $select.val();
                var $initialOption = $options.filter('[data-value="' + initialValue + '"]');

                // 초기 선택값이 disabled인 경우 첫 번째 사용 가능한 항목 선택
                if ($initialOption.length > 0 && $initialOption.attr('disabled')) {
                    var $firstAvailable = $options.not('[disabled]').first();
                    if ($firstAvailable.length > 0) {
                        initialValue = $firstAvailable.data('value');
                        var displayText = $firstAvailable.text().replace(/\s*\(품절\)\s*/g, '').trim();
                        $text.text(displayText);
                        $firstAvailable.addClass('selected');
                    }
                } else if ($initialOption.length > 0) {
                    var displayText = $initialOption.text().replace(/\s*\(품절\)\s*/g, '').trim();
                    $text.text(displayText);
                    $initialOption.addClass('selected');
                }

                // 버튼 클릭 시 드롭다운 토글
                $btn.click(function (e) {
                    e.stopPropagation();
                    // 다른 모든 custom-select 닫기
                    $('.prd-detail-page .custom-select').not($wrapper).removeClass('active');
                    // 현재 클릭한 것만 토글
                    $wrapper.toggleClass('active');
                });

                // 옵션 클릭 시 선택
                $options.click(function (e) {
                    e.stopPropagation();

                    // disabled인 경우 선택 불가
                    if ($(this).attr('disabled')) {
                        return;
                    }

                    var value = $(this).data('value');
                    var text = $(this).text().replace(/\s*\(품절\)\s*/g, '').trim();

                    // 선택값 업데이트
                    $select.val(value);
                    $text.text(text);

                    // 선택된 옵션 표시 업데이트
                    $options.removeClass('selected');
                    $(this).addClass('selected');

                    // 드롭다운 닫기
                    $wrapper.removeClass('active');

                    // change 이벤트 트리거
                    $select.trigger('change');
                });

                // 외부 클릭 시 드롭다운 닫기
                $(document).click(function (e) {
                    if (!$wrapper.is(e.target) && $wrapper.has(e.target).length === 0) {
                        $wrapper.removeClass('active');
                    }
                });
            });

            // 오버레이나 외부 클릭 시 오버레이 닫기
            $(document).on('mousedown', function (e) {
                var $openedOverlay = $('.cart-rec-add-overlay.show');
                if ($openedOverlay.length === 0) return;

                // 버튼 눌렀을 땐 닫지 않는다
                if ($(e.target).closest('.cart-rec-add-overlay button, .cart-rec-add-btn').length) {
                    return;
                }

                // 오버레이 내부 클릭시(버튼 제외)는 닫지 않음
                if ($(e.target).closest('.cart-rec-add-overlay').length) {
                    return;
                }

                gsap.set($openedOverlay, { opacity: 1, 'overflow': 'hidden' });
                gsap.to($overlay, {
                    delay: 0.1,
                    duration: 0.2,
                    opacity: 0,
                    ease: "power2.in"
                });

                $overlayDiv = $overlay.children();
                gsap.set($overlayDiv, { y: '0' });
                gsap.to($overlayDiv, {
                    duration: 0.3,
                    y: '100%',
                    ease: "power2.in",
                    onComplete: function () {
                        $openedOverlay.removeClass('show');
                    }
                });
            });

        }

        const POPUP = {
            popupStack: [],

            init: function () {
                const t = this;

                $('.popup-show-btn').click(function () {
                    const targetId = $(this).data('popup');
                    t.show(targetId);
                });

                $('.popup .close-btn').click(function () {
                    const popupId = $(this).closest('.popup').attr('id');
                    t.hide(popupId);
                });

                $('.popup-dim').click(function (event) {
                    if (t.popupStack.length === 0) {
                        return
                    }

                    const lastPopupId = t.popupStack.pop();
                    t.hide(lastPopupId);
                });
            },

            show: function (popupId) {
                if (!this.popupStack.includes(popupId)) {
                    this.popupStack.push(popupId);
                }

                // 배경 딤 show (gsap fade in)
                $('.popup-dim').css('display', 'block'); // 보이게 하고
                $('html,body').css('overflow', 'hidden');

                const $popup = $('#' + popupId);
                if (!$popup) {
                    return
                }
                $popup.scrollTop(0);

                if ($popup.hasClass('right-popup')) {

                    gsap.set($popup, { opacity: 1, display: 'block', x: '100%' });

                    gsap.to($popup, {
                        duration: 0.3,
                        x: '0',
                        ease: "power2.out"
                    });
                }
                else {
                    gsap.set($popup, { opacity: 0, display: 'block' });
                    gsap.to($popup, {
                        duration: 0.2,
                        opacity: 1,
                        ease: "power2.out",
                    });
                }
                gsap.to('.popup-dim', {
                    duration: 0.3, opacity: 0.7, ease: "power2.out", onComplete: function () {
                        $('.popup-dim').css('display', 'block');
                    }
                });
            },

            hide: function (popupId) {
                const $popup = $('#' + popupId);

                if ($popup.hasClass('right-popup')) {

                    gsap.to($popup, {
                        duration: 0.3,
                        x: '100%',
                        ease: "power2.in",
                        onComplete: function () {
                            //$popup.css({ display: 'none' });
                        }
                    });
                }
                else {
                    gsap.to($popup, {
                        duration: 0.2,
                        opacity: 0,
                        ease: "power2.in",
                        onComplete: function () {
                            $popup.css({ display: 'none' });
                        }
                    });
                }


                this.popupStack = this.popupStack.filter(id => id !== popupId);
                if (this.popupStack.length === 0) {
                    $('html,body').css('overflow', 'auto');
                    // 배경 딤 fade out
                    gsap.to('.popup-dim', {
                        duration: 0.3,
                        opacity: 0,
                        ease: "power2.in",
                        onComplete: function () {
                            $('.popup-dim').css('display', 'none');
                        }
                    });
                }
            }
        };

        initCartPopup();
        POPUP.init();
        POPUP.show('cart-popup');
    </script>
</body>

</html>